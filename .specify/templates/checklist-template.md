# [CHECKLIST TYPE] Checklist: [FEATURE NAME]

**Purpose**: [Brief description of what this checklist covers]
**Created**: [DATE]
**Feature**: [Link to spec.md or relevant documentation]

**Note**: Generated by `/speckit.checklist`. Adapt categories to feature, make items specific (e.g., "US1-AS1: Test customer enrollment").

## Pre-Implementation

- [ ] CHK001 No unnecessary complexity (violations justified)
- [ ] CHK002 Unclear requirements marked [NEEDS CLARIFICATION]
- [ ] CHK003 Acceptance scenarios complete and testable

## Protobuf (Principle V)

- [ ] CHK010 API types in `.proto` with validation rules
- [ ] CHK011 Generated code committed to `api/gen/v1/`
- [ ] CHK012 No `map[string]interface{}` used

## Service Architecture (Principle X)

- [ ] CHK020 Services in PUBLIC `services/` (NOT `internal/`), return protobuf types
- [ ] CHK021 Services have NO HTTP dependencies, use builder pattern
- [ ] CHK022 Handlers are thin wrappers, `AutoMigrate()` exported
- [ ] CHK023 Models in `internal/models/` only

## Error Handling (Principle XI)

- [ ] CHK030 Sentinel errors in `services/errors.go`, wrapped with `fmt.Errorf("%w")`
- [ ] CHK031 HTTP error singleton in `handlers/error_codes.go` with `ServiceErr` mapping
- [ ] CHK032 `HandleServiceError()` uses automatic mapping (no switch)
- [ ] CHK033 ALL errors (sentinel + HTTP) have test cases

## Integration Tests (Principles I, II)

- [ ] CHK040 Integration tests (NO mocking), real PostgreSQL via testcontainers
- [ ] CHK041 Table-driven design with descriptive `name` fields
- [ ] CHK042 Shared setup/teardown in helpers

## Acceptance Scenarios (Principle VIII)

- [ ] CHK050 US1-AS1: [Scenario] - Test implemented
- [ ] CHK051 US1-AS2: [Scenario] - Test implemented
- [ ] CHK052 All spec scenarios tested with US#-AS# references

## Edge Cases (Principle III - NON-NEGOTIABLE)

- [ ] CHK060 **Input validation**: Empty/nil, invalid formats, SQL injection, XSS
- [ ] CHK070 **Boundaries**: Zero/negative/max values, empty arrays, nil pointers
- [ ] CHK080 **Auth** (if applicable): Missing/expired/invalid tokens, insufficient permissions
- [ ] CHK090 **Data state**: 404s, duplicates, concurrent modifications
- [ ] CHK100 **Database** (if applicable): Constraints, foreign keys, transaction conflicts
- [ ] CHK110 **HTTP**: Wrong methods, missing headers, invalid content-types, malformed JSON

## ServeHTTP Testing (Principle IV)

- [ ] CHK120 Tests call root mux ServeHTTP (NOT handler methods), use `httptest`
- [ ] CHK121 Shared routing config, HTTP path patterns (e.g., `"POST /api/v1/products/{id}"`)
- [ ] CHK122 Path params via `r.PathValue()` (NOT URL manipulation)
- [ ] CHK123 Response status/headers/body verified

## Protobuf Assertions (Principle V)

- [ ] CHK130 Use `cmp.Diff()` with `protocmp.Transform()` (NO `==` or field comparisons)
- [ ] CHK131 Expected values from fixtures (NOT response, except UUIDs/timestamps)
- [ ] CHK132 Fixture sources documented in comments

## Database Fixtures (Principle I)

- [ ] CHK140 Fixtures inserted via GORM, use helpers (`testutil.CreateTestXxx()`)
- [ ] CHK141 Tests use `defer truncateTables(db, "tables...")` with CASCADE

## Context (Principle XII)

- [ ] CHK150 Services accept `context.Context` first, handlers use `r.Context()`
- [ ] CHK151 Database uses `db.WithContext(ctx)`, external calls use `http.NewRequestWithContext()`
- [ ] CHK152 Long-running ops check `ctx.Done()`, tests verify cancellation

## Tracing (Principle XI)

- [ ] CHK160 HTTP endpoints create OpenTracing spans with operation names
- [ ] CHK161 Service methods create child spans, database as ONE span per transaction
- [ ] CHK162 Errors tagged `span.SetTag("error", true)`, includes http.method/url/status tags

## Test Execution (Principle VI)

- [ ] CHK170 Tests written BEFORE implementation (TDD)
- [ ] CHK171 Tests run after EVERY change, pass before commit
- [ ] CHK172 Race detector used, failures fixed immediately (NOT skipped)

## Coverage (Principle IX)

- [ ] CHK180 `go test -cover` run, gaps analyzed
- [ ] CHK181 Coverage >80% achieved, missing tests added or dead code removed

## Root Cause (Principle VII)

- [ ] CHK190 Problems traced to root cause (NOT symptoms/workarounds)
- [ ] CHK191 Tests NOT removed/weakened, root cause verified

## Code Review

- [ ] CHK200 Constitution compliance verified
- [ ] CHK201 All scenarios tested (US#-AS# in names), success + error paths
- [ ] CHK202 Tests run and passed, errors wrapped with `%w`
- [ ] CHK203 Services PUBLIC (return protobuf), no skipped tests

## Cleanup

- [ ] CHK210 Root cause documented (if debugging), temp files removed
- [ ] CHK211 Comments explain WHY, protobuf code committed, no hardcoded values

## Notes

Check off items: `[x]`, add comments inline, remove inapplicable sections, add feature-specific items
