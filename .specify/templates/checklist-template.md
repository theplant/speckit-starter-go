# [CHECKLIST TYPE] Checklist: [FEATURE NAME]

**Purpose**: [Brief description of what this checklist covers]
**Created**: [DATE]
**Feature**: [Link to spec.md or relevant documentation]

**Note**: This checklist is generated by the `/speckit.checklist` command based on feature context and requirements. All items reflect Go Project Constitution requirements.

<!-- 
  ============================================================================
  IMPORTANT: The checklist items below are TEMPLATE CATEGORIES for illustration.
  
  The /speckit.checklist command MUST:
  - Adapt these categories to the specific feature being implemented
  - Add/remove categories based on feature requirements
  - Make items specific and actionable for the feature
  - Reference specific acceptance scenarios (US#-AS#) where applicable
  
  Examples:
  - Generic: "All acceptance scenarios have tests"
  - Specific: "US1-AS1: Test new customer enrollment with valid data"
  ============================================================================
-->

## Constitution Check (Before Implementation)

- [ ] CHK001 Feature does not introduce unnecessary complexity (no violations without justification)
- [ ] CHK002 All unclear requirements marked with [NEEDS CLARIFICATION] in spec
- [ ] CHK003 Acceptance scenarios are complete and testable

## Protobuf Definitions (Principle VI)

- [ ] CHK010 All API request/response types defined in `.proto` files
- [ ] CHK011 Protobuf field validation rules added (using protoc-gen-validate)
- [ ] CHK012 Generated Go code committed to `api/gen/v1/`
- [ ] CHK013 No `map[string]interface{}` used in handlers or services

## Service Layer Architecture (Principle XI)

- [ ] CHK020 Services are in public `services/` package (NOT `internal/services/`)
- [ ] CHK021 Services return protobuf types, NOT GORM models
- [ ] CHK022 Services do NOT depend on HTTP types (`http.Request`, `http.ResponseWriter`)
- [ ] CHK023 HTTP handlers are thin wrappers that call service methods
- [ ] CHK024 Dependencies injected via constructor (database, logger, cache)
- [ ] CHK025 `AutoMigrate()` function exported in `services/migrations.go`
- [ ] CHK026 Internal models in `internal/models/` for database mapping only

## Error Handling (Principle XIII)

- [ ] CHK030 Sentinel errors defined in `services/errors.go` (e.g., `ErrProductNotFound`)
- [ ] CHK031 Errors wrapped with context using `fmt.Errorf("operation: %w", err)`
- [ ] CHK032 HTTP error code singleton defined in `handlers/error_codes.go`
- [ ] CHK033 `ErrorCode.ServiceErr` field maps service errors to HTTP codes
- [ ] CHK034 `HandleServiceError()` uses automatic error mapping (no switch statement)
- [ ] CHK035 Error responses do NOT expose internal details (no stack traces)
- [ ] CHK036 ALL sentinel errors have corresponding test cases
- [ ] CHK037 ALL HTTP error codes have corresponding test cases

## Integration Test Design (Principles I-II)

- [ ] CHK040 Tests are integration tests (NO mocking of database/HTTP/external services)
- [ ] CHK041 Tests use real PostgreSQL via testcontainers-go
- [ ] CHK042 Tests follow table-driven design with `[]struct` and `name` field
- [ ] CHK043 Test cases have descriptive names documenting scenarios
- [ ] CHK044 Shared setup/teardown extracted to helper functions

## Acceptance Scenario Coverage (Principle IX)

<!-- Customize this section with actual scenarios from spec.md -->

- [ ] CHK050 US1-AS1: [Scenario description] - Test implemented
- [ ] CHK051 US1-AS2: [Scenario description] - Test implemented
- [ ] CHK052 US2-AS1: [Scenario description] - Test implemented
- [ ] CHK053 US2-AS2: [Scenario description] - Test implemented
- [ ] CHK054 All spec scenarios have corresponding test cases with US#-AS# references

## Edge Case Coverage (Principle III - NON-NEGOTIABLE)

**Input Validation**:
- [ ] CHK060 Empty strings tested
- [ ] CHK061 Nil/null values tested
- [ ] CHK062 Invalid formats tested
- [ ] CHK063 SQL injection attempts tested
- [ ] CHK064 XSS payloads tested

**Boundary Conditions**:
- [ ] CHK070 Zero values tested
- [ ] CHK071 Negative numbers tested
- [ ] CHK072 Maximum values tested
- [ ] CHK073 Empty arrays tested
- [ ] CHK074 Nil pointers tested

**Authentication/Authorization** (if applicable):
- [ ] CHK080 Missing tokens tested
- [ ] CHK081 Expired tokens tested
- [ ] CHK082 Invalid tokens tested
- [ ] CHK083 Insufficient permissions tested

**Data State**:
- [ ] CHK090 Non-existent resources (404) tested
- [ ] CHK091 Duplicate entries (conflict) tested
- [ ] CHK092 Concurrent modifications tested

**Database Errors** (if applicable):
- [ ] CHK100 Constraint violations tested
- [ ] CHK101 Foreign key failures tested
- [ ] CHK102 Transaction conflicts tested

**HTTP Specifics**:
- [ ] CHK110 Wrong HTTP methods tested
- [ ] CHK111 Missing headers tested
- [ ] CHK112 Invalid content-types tested
- [ ] CHK113 Malformed JSON tested

## ServeHTTP Testing (Principle V)

- [ ] CHK120 Tests use `httptest.ResponseRecorder` and `httptest.NewRequest`
- [ ] CHK121 Tests call root routes handler ServeHTTP (NOT individual handler methods)
- [ ] CHK122 URL routing and path handling tested through root HTTP mux
- [ ] CHK123 Production and tests use identical routing configuration
- [ ] CHK124 HTTP path patterns used (e.g., `"POST /api/v1/products/{productID}"`)
- [ ] CHK125 Path parameters extracted using `r.PathValue()` (NOT URL manipulation)
- [ ] CHK126 Response status codes verified
- [ ] CHK127 Response headers verified
- [ ] CHK128 Response body content verified

## Protobuf Assertions (Principle VI)

- [ ] CHK130 Tests use `cmp.Diff()` with `protocmp.Transform()` for ALL protobuf comparisons
- [ ] CHK131 Tests do NOT use individual field comparisons for protobuf messages
- [ ] CHK132 Tests do NOT use `==` or `reflect.DeepEqual` for protobuf
- [ ] CHK133 Expected values derived from TEST FIXTURES (request data, DB fixtures)
- [ ] CHK134 Expected values do NOT copy from response (except UUIDs, timestamps, crypto-rand)
- [ ] CHK135 Fixture source documented in comments (e.g., "// From testutil/fixtures.go:21")

## Real Database Fixtures (Principle IV)

- [ ] CHK140 Fixture data inserted using GORM to real database
- [ ] CHK141 Fixtures represent realistic production data scenarios
- [ ] CHK142 Complex fixtures use helper functions (e.g., `testutil.CreateTestXxx()`)
- [ ] CHK143 Fixture helpers return created entities
- [ ] CHK144 Fixtures handle database constraints correctly
- [ ] CHK145 Tests use `defer truncateTables(db, "table1", "table2")` for cleanup
- [ ] CHK146 Truncation uses CASCADE for foreign key dependencies

## Context-Aware Operations (Principle XIV)

- [ ] CHK150 All service methods accept `context.Context` as first parameter
- [ ] CHK151 HTTP handlers extract context from `r.Context()`
- [ ] CHK152 Database operations use `db.WithContext(ctx)`
- [ ] CHK153 External HTTP calls use `http.NewRequestWithContext(ctx, ...)`
- [ ] CHK154 Long-running operations check `ctx.Done()` periodically
- [ ] CHK155 Tests verify context cancellation behavior

## Distributed Tracing (Principle XII)

- [ ] CHK160 Each HTTP endpoint creates OpenTracing span
- [ ] CHK161 Spans include operation name matching endpoint
- [ ] CHK162 Service methods create child spans
- [ ] CHK163 Database operations traced as single span per transaction (NOT per query)
- [ ] CHK164 Error conditions tagged with `span.SetTag("error", true)`
- [ ] CHK165 Spans include relevant tags (http.method, http.url, http.status_code)

## Test Execution & Verification (Principle VII)

- [ ] CHK170 Tests written BEFORE implementation (TDD workflow followed)
- [ ] CHK171 Tests executed after EVERY code change
- [ ] CHK172 ALL tests pass before commit
- [ ] CHK173 Tests run with race detector (`go test -race ./...`)
- [ ] CHK174 Test failures fixed immediately (NOT skipped or disabled)
- [ ] CHK175 Flaky tests fixed (NOT just re-run until pass)

## Test Coverage Analysis (Principle X)

- [ ] CHK180 `go test -cover` executed to identify gaps
- [ ] CHK181 Uncovered code paths analyzed (dead code vs missing tests)
- [ ] CHK182 Coverage >80% for business logic achieved
- [ ] CHK183 Missing tests added for uncovered paths
- [ ] CHK184 Dead code removed rather than exempted

## Root Cause Tracing (Principle VIII)

- [ ] CHK190 Problems traced backward through call chain to original trigger
- [ ] CHK191 Symptoms distinguished from root causes
- [ ] CHK192 Fixes address source of problem (NOT workarounds)
- [ ] CHK193 Test cases NOT removed or weakened to make tests pass
- [ ] CHK194 Root cause verified through testing

## Code Review Requirements

- [ ] CHK200 Constitution compliance verified (all applicable principles)
- [ ] CHK201 All acceptance scenarios from spec.md tested
- [ ] CHK202 Test case names reference source scenarios (US#-AS# in `name` field)
- [ ] CHK203 Both success and error paths tested for every operation
- [ ] CHK204 Evidence that tests were run and passed
- [ ] CHK205 No skipped or disabled tests without justification
- [ ] CHK206 Error wrapping uses `%w` verb (NOT `%v`)
- [ ] CHK207 Services in public packages (NOT internal/)
- [ ] CHK208 Services return protobuf types (NOT models)

## Documentation & Cleanup

- [ ] CHK210 Root cause analysis documented (if debugging was required)
- [ ] CHK211 Temporary files and helper scripts removed
- [ ] CHK212 Comments explain WHY, not WHAT (code is self-documenting)
- [ ] CHK213 Generated protobuf code committed
- [ ] CHK214 No hardcoded values that should be configuration

## Notes

- Check items off as completed: `[x]`
- Add comments or findings inline for each item
- Link to specific test files, line numbers, or code references
- Items are numbered sequentially for easy reference in code reviews
- Not all items apply to every feature - remove inapplicable sections
- Add feature-specific items as needed
